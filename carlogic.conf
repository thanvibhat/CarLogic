# Apache VirtualHost Configuration for CarLogic
# Docker configuration for serving React frontend and proxying API

<VirtualHost *:80>
    ServerName localhost
    ServerAlias *
    DocumentRoot "/usr/local/apache2/htdocs"

    # Serve static frontend files
    <Directory "/usr/local/apache2/htdocs">
        Options FollowSymLinks
        AllowOverride None
        Require all granted
        
        # React Router: Route all non-file requests to index.html
        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteBase /
            # If the request is for a real file, allow it
            RewriteCond %{REQUEST_FILENAME} -f [OR]
            RewriteCond %{REQUEST_FILENAME} -d
            RewriteRule ^.*$ - [L]
            # Otherwise, rewrite to index.html for SPA routing
            RewriteRule ^(.*)$ /index.html [L]
        </IfModule>
    </Directory>

    # Reverse proxy for API requests
    <Location /api>
        ProxyPass http://backend:8000/api
        ProxyPassReverse http://backend:8000/api
        ProxyPreserveHost On
    </Location>

    # Proxy WebSocket
    <Location /ws>
        ProxyPass ws://backend:8000/ws
        ProxyPassReverse ws://backend:8000/ws
        ProxyPreserveHost On
    </Location>

</VirtualHost>
